<div id="studentResult"></div>

<script>
const urlParams = new URLSearchParams(window.location.search);
const studentName = urlParams.get("name");
const studentClass = urlParams.get("class");

async function loadData() {
  const response = await fetch("students_results.csv");
  const text = await response.text();
  const rows = text.split("\n").slice(1); // تجاهل العناوين

  let found = false;
  rows.forEach(row => {
    const cols = row.split(",");
    const name = cols[0]?.trim();
    const cls = cols[1]?.trim();

    if (name === studentName && cls === studentClass) {
      found = true;
      let total = 0, maxTotal = 0;
      let table = "<table><tr><th>الحصة</th><th>الدرجة</th></tr>";

      cols.slice(2).forEach((grade, i) => {
        if (grade) {
          const [got, max] = grade.split("/").map(x => parseInt(x));
          total += got;
          maxTotal += max;
          table += `<tr><td>الحصة ${i+1}</td><td>${got} / ${max}</td></tr>`;
        }
      });

      const percent = (total / maxTotal) * 100;
      let status = "";
      if (percent >= 85) status = `<div class="grade excellent">🌟 ممتاز</div>`;
      else if (percent >= 70) status = `<div class="grade verygood">👍 جيد جدًا</div>`;
      else if (percent >= 50) status = `<div class="grade good">🙂 جيد</div>`;
      else status = `<div class="grade weak">⚠️ ضعيف</div>`;

      table += `<tr><th>المجموع</th><td>${total} / ${maxTotal}</td></tr>`;
      table += `<tr><th>النسبة المئوية</th><td>${percent.toFixed(2)}%</td></tr>`;
      table += "</table>";

      document.getElementById("studentResult").innerHTML = `
        <h2>${name}</h2>
        <h3>${cls}</h3>
        ${table}
        ${status}
      `;
    }
  });

  if (!found) {
    document.getElementById("studentResult").innerHTML =
      `<p style="color:red; font-weight:bold;">⚠️ الطالب أو الصف غير موجود</p>`;
  }
}
loadData();
</script>
